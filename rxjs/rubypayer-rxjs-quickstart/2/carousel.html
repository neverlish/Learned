<html>
<head>
  <style>
    .view {
      overflow: hidden;
    }

    .view .container {
      white-space: nowrap;
      padding: 0px;
      list-style: none;
      font-size: 0;
    }

    .view .panel {
      width: 100%;
      min-height: 200px;
      display: inline-block;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.2/rxjs.umd.min.js"></script>
</head>
<body>
  <div id="carousel" class="view">
    <ul class="container">
      <li class="panel" style="background-color:lightgreen">
      </li>
      <li class="panel" style="background-color:lightpink">
      </li>
      <li class="panel" style="background-color:royalblue">
      </li>
      <li class="panel" style="background-color:darkred">
      </li>
    </ul>
  </div>

  <script>
    const { fromEvent } = rxjs;
    const { mergeMap, takeUntil, map, switchMap, first } = rxjs.operators;

    const $view = document.getElementById('carousel');
    const $container = document.querySelector('.container');
    const PANEL_COUNT = $container.querySelectorAll('.panel').length;

    const SUPPORT_TOUCH = 'ontouchstart' in window;
    const EVENTS = {
      start: SUPPORT_TOUCH ? 'touchstart' : 'mousedown',
      move: SUPPORT_TOUCH ? 'touchmove' : 'mousemove',
      end: SUPPORT_TOUCH ? 'touchend' : 'mouseup'
    };

    function toPos(obj$) {
      return obj$
        .pipe(
          map(v => SUPPORT_TOUCH ? event.changedTouches[0].pageX : event.pageX)
        );
    }

    const start$ = fromEvent($view, EVENTS.start).pipe(toPos);
    const move$ = fromEvent($view, EVENTS.move).pipe(toPos);
    const end$ = fromEvent($view, EVENTS.end);

    const drag$ = start$.pipe(
      switchMap(start => {
        return move$.pipe(
          map(move => move - start),
          takeUntil(end$)
        );
      })
    );
    
    drag$.subscribe(distance => console.log("start$와 move$의 차이 값", distance));

    const drop$ = drag$.pipe(
      switchMap(drag => end$.pipe(first()))
    )
  </script>
</body>
</html>
